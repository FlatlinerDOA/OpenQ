function listen(n){return typeof n=="undefined"&&(n=null),n=n||8e3,new OpenQExpressServer(process.env.COMPUTERNAME+":"+process.pid,n)}var express,OpenQExpressServer,Server;exports.MessageTypes={success:"urn:simpleq/success",failed:"urn:simpleq/failed"},express=require("express"),exports.listen=listen,OpenQExpressServer=function(){function n(n,t){this.server=new Server,this.app=express(),this.app.get("/",this.signupForm),this.app.post("/signup",this.signup),this.app.post("/:username/inbox",this.sendMessage),this.app.get("/:username/inbox",this.getMessages),this.app.listen(t)}return n.prototype.signupForm=function(n,t){t.send('<html><body><h1>Signup to OpenQ<\/h1><form action="/signup" method="post"><div><label>Username<\/label><input type="text" name="username"><\/div><div><label>Password<\/label><input type="password" name="password"><\/div><input type="submit"><\/form><\/h1><\/body><\/html>')},n.prototype.signup=function(n,t){var i=this;this.server.createUser(n.body.username,n.body.password,function(n){i.end(n,t)})},n.prototype.end=function(n,t){if(n){this.failed(n,t);return}this.success(t)},n.prototype.failed=function(n,t){n.type="urn:simpleq/failed",t.format({html:"<html><body><h1>Uh oh!<\/h1><pre>"+n+"<\/pre><\/body><\/html>",json:n})},n.prototype.success=function(n){n.format({html:"<html><body><h1>Well done!<\/h1><\/body><\/html>",json:'{ "type":"urn:simpleq/success" }'})},n.prototype.sendMessage=function(n,t){var i=this,r=n.param("username"),u=n.secure;this.server.getUser(r,"",function(r,u){if(r){t.send(400,r.message);return}u.inbox.send(n.body,function(n){i.end(n,t)})})},n.prototype.getMessages=function(){},n}(),exports.OpenQExpressServer=OpenQExpressServer,Server=function(){function n(){}return n.prototype.createUser=function(n,t,i){if(this.users[n]){i&&i(new Error("User already exists"),null);return}var r=new User(n,t);this.users[n]=r,i&&i(null,r)},n.prototype.getUser=function(n,t,i){if(!this.users[n]){i(new Error("User does not exist"),null);return}i(null,this.users[n])},n.prototype.deleteUser=function(n,t,i){delete this.users[n],i&&i(null)},n}(),exports.Server=Server;var User=function(){function n(n,t){this.username=n,this.token=t,this.inbox=new Inbox,this.outbox=new Outbox,this.token=this.token||""}return n.prototype.requestSubscribe=function(){},n}(),Inbox=function(){function n(){}return n.prototype.send=function(){},n.prototype.poll=function(){},n.prototype.processedTo=function(){},n}(),Outbox=function(){function n(){}return n.prototype.subscribe=function(){},n.prototype.unsubscribe=function(){},n.prototype.broadcast=function(){},n.prototype.poll=function(){},n.prototype.processedTo=function(){},n}()