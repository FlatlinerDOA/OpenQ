function listen(n){return typeof n=="undefined"&&(n=null),n=n||8e3,new OpenQExpressServer(process.env.COMPUTERNAME+":"+process.pid,n)}var express,Server,OpenQExpressServer;exports.MessageTypes={success:"urn:simpleq/success",failed:"urn:simpleq/failed"},express=require("express"),Server=require("./openq.ts"),exports.listen=listen,OpenQExpressServer=function(){function n(n,t){this.server=new Server,this.app=express(),this.app.use(express.bodyParser()),this.app.get("/",this.signupForm),this.app.post("/signup",this.signup),this.app.get("/:username/inbox",this.getMessages),this.app.post("/:username/inbox",this.sendMessage),this.app.listen(t)}return n.prototype.signupForm=function(n,t){t.send('<html><body><h1>Signup to OpenQ<\/h1><form action="/signup" method="post"><div><label>Username<\/label><input type="text" name="username"><\/div><div><label>Password<\/label><input type="password" name="password"><\/div><input type="submit"><\/form><\/h1><\/body><\/html>')},n.prototype.signup=function(n,t){var i=this;this.server.createUser(n.body.username,n.body.password,function(n){i.end(n,t)})},n.prototype.end=function(n,t){if(n){this.failed(n,t);return}this.success(t)},n.prototype.failed=function(n,t){n.type="urn:simpleq/failed",t.format({html:"<html><body><h1>Uh oh!<\/h1><pre>"+n+"<\/pre><\/body><\/html>",json:n})},n.prototype.success=function(n){n.format({html:"<html><body><h1>Well done!<\/h1><\/body><\/html>",json:'{ "type":"urn:simpleq/success" }'})},n.prototype.sendMessage=function(n,t){var i=this,r=n.param("username"),u=n.secure;this.server.getUser(r,"",function(r,u){if(r){t.send(400,r.message);return}u.inbox.send(n.body,function(n){i.end(n,t)})})},n.prototype.getMessages=function(){},n}(),exports.OpenQExpressServer=OpenQExpressServer